# Workshop: Безпечна Автентифікація (Auth & Security)

Ми починаємо будувати фінальний проєкт курсу — гру **"Камінь-Ножиці-Папір MMO"**.
Але будь-яка серйозна система починається не з гри, а з **Користувача**.

Ваше завдання: реалізувати систему входу, яка не зберігає паролі у відкритому вигляді.

## 1. Задача Інженера

Ми маємо форму реєстрації (Логін, Пароль).
Ми хочемо зберігати користувачів у `localStorage` (бо у нас немає бекенду).

**Проблема:** Якщо ми збережемо `{"password": "123"}`, будь-який XSS-скрипт або людина, що сіла за ваш комп'ютер, вкраде пароль.

**Рішення:** Ми будемо зберігати **Хеш** (Hash).
`"123"` -> `SHA-256` -> `"a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3"`

## 2. Web Crypto API

Браузер має вбудований криптографічний модуль `window.crypto`. Використаємо його.

Створіть файл `auth.js` і додайте функцію хешування:

```javascript
async function hashPassword(password) {
    const encoder = new TextEncoder();
    const data = encoder.encode(password);
    
    // Використовуємо SHA-256 (Secure Hash Algorithm)
    const hashBuffer = await crypto.subtle.digest('SHA-256', data);
    
    // Конвертуємо бінарний буфер у шістнадцятковий рядок (hex string)
    const hashArray = Array.from(new Uint8Array(hashBuffer));
    const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    
    return hashHex;
}
```

> **Важливо:** Цей API працює тільки в **Secure Context** (HTTPS або `localhost`). Якщо ви відкриєте файл просто як `file://index.html`, воно може не працювати в деяких браузерах. Використовуйте локальний сервер (наприклад, розширення Live Server у VS Code).

## 3\. Реєстрація (Sign Up)

Реалізуйте логіку:

1.  Отримати дані з форми.
2.  Перевірити, чи існує юзер з таким ніком (у масиві `users`).
3.  Захешувати пароль (`await hashPassword(...)`).
4.  Зберегти об'єкт юзера (з **хешем**, а не паролем) у масив.
5.  Зберегти масив у `localStorage`.

```javascript
const newUser = {
    nickname: "player1",
    passwordHash: "a665...", // БЕЗПЕЧНО
    stats: { wins: 0, losses: 0 }
};
```

## 4\. Вхід (Log In)

Як перевірити пароль, якщо ми його не знаємо?

1.  Юзер вводить "123".
2.  Ми хешуємо це -\> "a665...".
3.  Ми порівнюємо цей хеш з тим, що лежить у базі.
4.  Збігаються? Доступ дозволено.

## 5\. Челендж "Злам"

1.  Зареєструйте юзера з паролем "secret".
2.  Відкрийте DevTools -\> Application -\> Local Storage.
3.  Знайдіть там запис `users`.
4.  Спробуйте "вгадати" пароль, дивлячись тільки на хеш. (Це неможливо без Brute Force).
5.  **Висновок:** Ви створили систему, стійку до витоку бази даних.